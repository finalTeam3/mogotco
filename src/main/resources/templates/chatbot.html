<!DOCTYPE html>
<html lang="en">
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<style>
body {
    background-color: #f5f5f5;
}

#main-content {
    max-width: 940px;
    padding: 2em 3em;
    margin: 0 auto 20px;
    background-color: #fff;
    border: 1px solid #e5e5e5;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
}
</style>

<style>
#div_chatbot body {
  margin: 0;
  padding: 0;
   background-color: #f6f7f9;
}

#div_chatbot h1 {
  margin-left: 25px;
  font-size: 16px;
  line-height: 1;
  font-weight:bold;
  font-family: Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
  color:#769BCD;
}

#div_chatbot button {
  color: inherit;
  background-color: transparent;
  border: 0;
  outline: 0 !important;
  cursor: pointer;
}
#div_chatbot button.chatbox-open {
  position: fixed;
  bottom: 3rem;
  right: 2rem;
  width: 60px;
  height: 60px;
  color: #769BCD;
  background-color: #fff;
  background-position: center center;
  background-repeat: no-repeat;
  box-shadow: 12px 15px 20px 0 rgba(46, 61, 73, 0.15);
  border:1px solid #DCDCDC;
  border-radius: 50%;
  cursor: pointer;
  margin: 16px;
}
#div_chatbot button.chatbox-close {
  position: fixed;
  bottom: 3rem;
  right: 4rem;
  width: 60px;
  height: 60px;
  color:#769BCD;
  background-color:#fff;
  background-position: center center;
  background-repeat: no-repeat;
  box-shadow: 12px 15px 20px 0 rgba(46, 61, 73, 0.15);
  border:1px solid #DCDCDC;
  border-radius: 50%;
  cursor: pointer;
  display: none;
  margin: 16px calc(2 * 16px + 52px) 16px 16px;
}

#div_chatbot textarea {
  position: fixed;
  bottom:10rem;
  box-sizing: border-box;
  max-width:230px;
  width: 70%;
  margin: 0;
  height: calc(16px + 16px / 2);
  padding: 0 calc(16px / 2);
  font-family: inherit;
  font-size: 16px;
  line-height: calc(16px + 16px / 2);
  color: #888;
  background-color: none;
  border: 0;
  outline: 0 !important;
  resize: none;
  overflow-y:scroll;
}
#div_chatbot textarea::-moz-placeholder {
  color: #888;
}
#div_chatbot textarea:-ms-input-placeholder {
  color: #888;
}
#div_chatbot textarea::placeholder {
  color: #888;
}

#div_chatbot .chatbox-popup {
  position: fixed;
  display: flex;
  box-shadow: 5px 5px 25px 0 rgba(46, 61, 73, 0.2);
  flex-direction: column;
  display: none;
  bottom: calc(2 * 16px + 52px);
  right: 16px;
  width: 100px;
  height: auto;
  background-color: #fff;
  border-radius: 16px;
}
#div_chatbot .chatbox-popup .chatbox-popup__header {
  position: fixed;	
  bottom:31.5rem;
  right:5rem;
  box-sizing: border-box;
  display: flex;
  max-width:300px;
  width: 70%;
  padding: 13px 16px 30px 16px;
  color: #769BCD;
  background-color:#fff;
  align-items: center;
  justify-content: space-around;
  border-top-right-radius: 12px;
  border-top-left-radius: 12px;
  box-shadow:0 -5px 5px -5px #769BCD, -5px 0 5px -5px #769BCD, 5px 0 5px -5px #769BCD;
}

 #btn_exit i{
	color:#769BCD !important;
}

#div_chatbot .chatbox-popup .chatbox-popup__main {
  max-width:300px;
  height:320px;
  width: 70%;
  position: fixed;
  right:5rem;
  bottom:12.1rem;
  box-sizing: border-box;
  padding: 6px 16px;
  line-height: calc(16px + 16px / 2);
  color: black;
  font-size:0.85rem;
  font-family: Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, "Helvetica Neue", "Segoe UI", "Apple SD Gothic Neo", "Noto Sans KR", "Malgun Gothic", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif !important;
 
  text-align: center;
  background-color:#fff;
   box-shadow: -5px 0 5px -5px #769BCD, 5px 0 5px -5px #769BCD;
}

#div_chatroom{
	overflow-y:scroll;
	height:300px;
	padding:0 5px 0 5px;
}

#div_chatroom::-webkit-scrollbar{
	display:none;
	width:0 !important;	
}

#div_chatbot .chatbox-popup .chatbox-popup__footer {
  position: fixed;
  max-width:300px;
  width: 70%;
  right:5rem;
  bottom:9rem;
  box-sizing: border-box;
  display: flex;
  padding: 16px;
  align-items: center;
  justify-content: space-around;
  border-bottom-right-radius: 12px;
  border-bottom-left-radius: 12px;
  background-color:white;
  box-shadow:0 5px 5px -5px #769BCD, -5px 0 5px -5px #769BCD, 5px 0 5px -5px #769BCD;
}


#div_chatroom .chattext{
	margin-bottom:10px;
	background-color: #f6f6f6;
	padding:8px;
	border-radius:12px;
}

.chat_ask{
	max-width:200px;
	float:right;
	margin-right:0;
	margin-left:100px;
	text-align:right;
}

.chat_ask .chattext{
	background-color:#e3effd !important;
}

.chat_response{
	float:left;
	max-width:200px;
	text-align:left;
	margin-right:100px;
}

#btn_sendmessage:hover{
	color:#769BCD;
	cursor:pointer;
}
</style>
<script>
function connect3(){
	var socket = new SockJS('http://127.0.0.1/mogotco/ws');
	stompClient = Stomp.over(socket);
	stompClient.connect({}, function(frame){
		stompClient.subscribe('/topic/public', function(message){
			showMessage3("받은 메시지: " + message.body);
		});
	});
}


function disconnect3(){
	if(stompClient !== null){
		stompClient.disconnect();
	}
}


function sendMessage(){
	var question = $('#ta_chatquestion').val();
	
	if(question.trim() == ''){
		alert('질문을 입력하세요');
		$('#ta_chatquestion').focus();
		return;
		}
	
	$('#div_chatroom').append('<div class="chat_ask"><p class="chattext">' + question + '</p></div>');
	$("#div_chatroom").scrollTop($("#div_chatroom")[0].scrollHeight);
	setTimeout(() => getAnswer(question), 200);
}

function getAnswer(question){
	$.ajax({
		url:'[[@{/app/sendMessage}]]',
		data:{
			'question': question
		},
		success:function(result){
			showMessage3(result);
		}
	});
}


function showMessage3(answer){
	$('#div_chatroom').append('<div class="chat_response"><p class="chattext">' + answer + '</p></div>');
	$("#div_chatroom").scrollTop($("#div_chatroom")[0].scrollHeight);
	$('#ta_chatquestion').val('');
}

/* ChatBot */
 
 $(function() {
const chatbox = jQuery.noConflict();

  $('#btn_startchat').click(function(){
	  chatbox(".chatbox-popup, .chatbox-close").fadeIn();
	  connect();
	  $('#ta_chatquestion').focus();
  });

  $('.toclose').click(function(){
	  chatbox(".chatbox-popup, .chatbox-close").fadeOut();
	  disconnect();
  });
  
  $('#btn_sendmessage').click(function(){
	  sendMessage();
  });
  
  $('#ta_chatquestion').keydown(function(key){
	  if(key.keyCode == 13){
		  sendMessage();
	  }
  });
  
 });
</script>

<head>
    <meta charset="utf-8">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">  

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link th:href="@{/lib/animate/animate.min.css}" rel="stylesheet">
    <link th:href="@{/lib/owlcarousel/assets/owl.carousel.min.css}" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link th:href="@{/css/style.css}" rel="stylesheet">
        <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/lib/easing/easing.min.js}"></script>
    <script th:src="@{/lib/owlcarousel/owl.carousel.min.js}"></script>

    <!-- Contact Javascript File -->
    <script th:src="@{/mail/jqBootstrapValidation.min.js}"></script>
    <script th:src="@{/mail/contact.js}"></script>

    <!-- Template Javascript -->
    <script th:src="@{/js/main.js}"></script>
    
    <script th:src="@{/webjars/sockjs-client/sockjs.min.js}"></script>
    <script th:src="@{/webjars/stomp-websocket/stomp.min.js}"></script>    
</head>

<body>
	<div class="courses"></div>


    <!-- Checkout Start -->

    <!-- Checkout End -->


<noscript><h2 style="color: #ff0000">Seems your browser doesn't support Javascript! Websocket relies on Javascript being
    enabled. Please enable
    Javascript and reload this page!</h2></noscript>
    
<div id="main-content" class="container">
    <div class="row">
    
        <div class="col-md-6">
            <form class="form-inline">
                <div class="form-group">
                    <label for="connect">웹소켓 연결:</label>
                    <button id="connect" class="btn btn-default" type="submit">연결</button>
                    <button id="disconnect" class="btn btn-default" type="submit" disabled="disabled">해제
                    </button>
                </div>
            </form>
        </div>
        
<!--        <div class="col-md-6">
            <form class="form-inline">
                <div class="form-group">
                    <label for="msg"></label>
                    <input type="text" id="msg" class="form-control" placeholder="내용을 입력하세요....">
                </div>
                <button id="send" class="btn btn-default" disabled type="submit">보내기</button>
            </form>
        </div>  -->
    </div>
				
</div>

					  
					  	<!-- Chatbot Start -->
	<div id="div_chatbot">
		<button class="chatbox-open" id="btn_startchat">
			<i class="fa fa-comment fa-2x" aria-hidden="true"></i>
		</button>
		<button class="chatbox-close toclose">
			<i class="fa fa-close fa-2x" aria-hidden="true"></i>
		</button>

		<section class="chatbox-popup">
			<header class="chatbox-popup__header">
				<aside style="flex: 3">
					<i class="fa-regular fa-comment-dots"></i>
				</aside>
				<aside style="flex: 8">
					<h1 id="h1_chatbotname">당근PT 챗봇</h1>
				</aside>
				<aside style="flex: 1">
					<button id="btn_exit" class="chatbox-close-x toclose">
						<i class="fa-solid fa-x"></i>
					</button>
				</aside>
			</header>

			<main class="chatbox-popup__main">
				<div id="div_chatroom"></div>
			</main>

			<footer class="chatbox-popup__footer">
				<aside style="flex: 13">
					<textarea type="text" id="ta_chatquestion" placeholder="메시지를 입력하세요"
						autofocus></textarea>
				</aside>
				<aside style="flex: 1; color: #888; text-align: center;">
					<i class="fa fa-paper-plane" id="btn_sendmessage"
						aria-hidden="true"></i>
				</aside>
			</footer>
		</section>
	</div>
		  
					  

</body>
</html>