<!DOCTYPE html>
<html lang="en">
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<style>
body {
    background-color: #f5f5f5;
}

#main-content {
    max-width: 940px;
    padding: 2em 3em;
    margin: 0 auto 20px;
    background-color: #fff;
    border: 1px solid #e5e5e5;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
}
</style>

<style>
	#chatbotimg{
		width: 45px;
		height: auto;
	}
	#sentimg{
		width: 26px;
		height: 26px;
	}
	#sendme{
		width : 10%;
		height: 66px;
		margin: auto;
		text-align: center;
		float: right;
		border: solid 1px #C9C9C9;
		background-color: #C9C9C9;
		border-radius: 5px;
	}
	#modalchat{
		background-color: #F5F5F5;
		
	}
	#chatbottitle{
		text-align: center;
		border-bottom: solid 1px #D1B2FF;
		font-family: 'Noto Sans KR', sans-serif;
	}
	#me{
		width:auto;
		height:auto;
		overflow: auto;
		margin:auto;
		background-color: #F5F5F5;
		padding: 50px;
		font-family: 'Noto Sans KR', sans-serif;
	}
	#btnsend{
		margin:auto;
		text-align: center;
	}
	#question{
		text-align: right;
		font-size: small;
		background-color: #D9E5FF;
	}
	#answer{
		font-size: small;
		background-color: white;
	}
	#ina{
		background: rgba(20,189,238,0.2);
		width: 40%;
		padding: 10px;
		border-radius: 10px;
		box-shadow: 2px 2px 2px 2px #BDBDBD;
		font-family: 'Noto Sans KR', sans-serif;
	}
	#inq{
		float: right;
		background: white;
		text-align:right;
		width: 40%;
		padding: 10px;
		border-radius: 10px;
		box-shadow: 2px 2px 2px 2px #BDBDBD;
		font-family: 'Noto Sans KR', sans-serif;
	}
	#chatinform{
		margin-bottom: 10px;
		
	    text-align: center;
		background: white;
		padding: 10px;
		border-radius: 10px;
		box-shadow: 2px 2px 2px 2px #BDBDBD;
		font-family: 'Noto Sans KR', sans-serif;
	}
	#metext{
		border: #D9E5FF solid 1px;
		border-radius: 5px;
		font-family: 'Noto Sans KR', sans-serif;
	}
	#answerchat{
		width: auto;
		height: 30px;
		display: inline;
	}
	#quser{
		width: auto;
		height: 30px;	
		border-radius: 50%;
		
	}
	#quserimg{
		text-align: right;
		margin-bottom: 0px;
		margin-top: 10px;
		background-color: white;
		
	}
	#center{
	
    min-height: 100%;
	padding-bottom: 400px;
	}
	
	#footer{
	position: absolute;
	left: 0;

    bottom: 0;

    width: 100%;
    
	}



</style>

<script>

var stompClient = null;

function setConnected(connected) {
    $("#connect").prop("disabled", connected);
    $("#disconnect").prop("disabled", !connected);
    $("#send").prop("disabled", !connected);
    if (connected) {
        $("#conversation").show();
    }
    else {
        $("#conversation").hide();
    }
    $("#msg").html("");
}

// 소켓을 통해 메시지를 챗봇 컨트롤러로 전송 후 답변을 받음
function connect() {
    var socket = new SockJS('http://127.0.0.1/mogotco/ws');
    stompClient = Stomp.over(socket);
    stompClient.connect({}, function (frame) {
        setConnected(true);
        console.log('Connected: ' + frame);
        stompClient.subscribe('/topic/public', function (message) {
        	alert(message);
            showMessage("받은 메시지: " + message.body); //서버에 메시지 전달 후 리턴받는 메시지
            alert(message.body)
        });
    });
}

function disconnect() {
    if (stompClient !== null) {
        stompClient.disconnect();
    }
    setConnected(false);
    console.log("Disconnected");
}

// 인풋창에서 메시지를 입력 후 전송
function sendMessage() {
    let message = $("#msg").val();
    showMessage("보낸 메시지: " + message);

    stompClient.send("/app/sendMessage", {}, JSON.stringify(message)); //서버에 보낼 메시지
}


function showMessage(message) {
    $("#me").append("<tr><td>" + message + "</td></tr>");
}

/* $(function () {
    $("form").on('submit', function (e) {
        e.preventDefault();
    });
    $( "#connect" ).click(function() { connect(); });
    $( "#disconnect" ).click(function() { disconnect(); });
    $( "#send" ).click(function() { sendMessage(); });
}); */



$(document).ready(function() {
	$("#openmodal").click(function() {
		connect();
		$("#me").append("<div id='answer'><img id='answerchat'><div id='ina'>안녕하세요 모같코입니다. '문의'라고 입력해주시면 자세히 안내 드릴게요!</div></div>");
	});
	
	$("#send").click(function() {
		//$('#msg').val('');
		sendMessage();
	    
	});
/* 	$('#msg').keypress(function(event){
	     if ( event.which == 13 ) {
	         $('#send').click();
	         return false;
	     } 
	});*/
	$('#modalclose').click(function() {
		 disconnect();
		});
});

</script>

<head>
    <meta charset="utf-8">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">  

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link th:href="@{/lib/animate/animate.min.css}" rel="stylesheet">
    <link th:href="@{/lib/owlcarousel/assets/owl.carousel.min.css}" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link th:href="@{/css/style.css}" rel="stylesheet">
        <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/lib/easing/easing.min.js}"></script>
    <script th:src="@{/lib/owlcarousel/owl.carousel.min.js}"></script>

    <!-- Contact Javascript File -->
    <script th:src="@{/mail/jqBootstrapValidation.min.js}"></script>
    <script th:src="@{/mail/contact.js}"></script>

    <!-- Template Javascript -->
    <script th:src="@{/js/main.js}"></script>
    
    <script th:src="@{/webjars/sockjs-client/sockjs.min.js}"></script>
    <script th:src="@{/webjars/stomp-websocket/stomp.min.js}"></script>    
</head>

<body>
	<div class="courses"></div>


    <!-- Checkout Start -->

    <!-- Checkout End -->


<noscript><h2 style="color: #ff0000">Seems your browser doesn't support Javascript! Websocket relies on Javascript being
    enabled. Please enable
    Javascript and reload this page!</h2></noscript>
    
<div id="main-content" class="container">
    <div class="row">
    
        <div class="col-md-6">
            <form class="form-inline">
                <div class="form-group">
                    <label for="connect">웹소켓 연결:</label>
                    <button id="connect" class="btn btn-default" type="submit">연결</button>
                    <button id="disconnect" class="btn btn-default" type="submit" disabled="disabled">해제
                    </button>
                </div>
            </form>
        </div>
        
<!--         <div class="col-md-6">
            <form class="form-inline">
                <div class="form-group">
                    <label for="msg"></label>
                    <input type="text" id="msg" class="form-control" placeholder="내용을 입력하세요....">
                </div>
                <button id="send" class="btn btn-default" disabled type="submit">보내기</button>
            </form>
        </div> -->
    </div>
    
<!--     <div class="row">
        <div class="col-md-12">
            <table id="conversation" class="table table-striped">
                <thead>
                <tr>
                    <th>안녕하세요 모같코입니다. 상담을 원하시면 '문의하기'를 입력해주세요</th>
                </tr>
                </thead>
                
                <tbody id="communicate">
                </tbody>
            </table>
            
        </div>
    </div> -->
				<a style="position:fixed;right:0.00001%;" href="#" title="챗봇 테스트" id="openmodal" data-toggle="modal" data-target="#myModal">
				<img src="img/clovaicon.jpg" alt="화면 고정 버튼" style="width:20%;">
				</a>
		
				<!-- 메인 페이지용 버튼  -->				
				<!-- <a style="position:fixed;right:3%;bottom:5%" href="#" title="챗봇 테스트" id="openmodal" data-toggle="modal" data-target="#myModal">
				<img src="img/clovaicon.jpg" alt="화면 고정 버튼" style="width:20%;">
				</a>   -->
				
</div>
					  <div class="modal fade" id="myModal" role="dialog">
					    <div class="modal-dialog">
					    <div class="modal-content">
					      <!-- Modal content-->
					      <div id="modalchat">
					      
					        <div class="modal-header">
					          <h4 id="chatbottitle" class="modal-title"><img id="chatbotimg" src="img/clovaicon.jpg"></h4>
					        </div>
								
							<div id="me"><div id="chatinform">챗봇에게 질문하세요</div></div>
							
							<div id="btnsend">
							<textarea id="msg" style="width:90%;" rows="3"></textarea>
							<button id="send" disabled type="submit"><img id="sentimg" src="img/sent.png" ></button>
							</div>
							
							<div class="modal-footer">
							<button id="modalclose" type="button" class="btn btn-info" data-dismiss="modal">Close</button>
							</div>
					        
					      </div>
					      </div>
					    </div>
					  </div>
					  
					  
					  
<!-- 	<div class="modal" >
    <div class="modal-dialog">
      <div class="modal-content">
      
        Modal Header
        <div class="modal-header">
			<h4 id="chatbottitle" class="modal-title"><img id="chatbotimg" src="img/clovaicon.jpg"></h4>
        </div>
        
        <div id="me"><div id="chatinform">챗봇에게 질문하세요</div></div>
        
        Modal body
        <div id="btnsend">
			<textarea id="msg" style="width:90%;" rows="3"></textarea>
			<button id="send"><img id="sentimg" src="/img/sent.png" ></button>
        </div>
        
        Modal footer
        <div class="modal-footer">
          <button id="modalclose" type="button" class="btn btn-dark" data-dismiss="modal">Close</button>
        </div>
        
      </div>
    </div>
  </div> -->
					  
					  

</body>
</html>